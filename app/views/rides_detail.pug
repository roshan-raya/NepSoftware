extends layout

block content
  if ride
    .container.py-4
      .row
        .col-md-8
          // Ride Details Card
          .card.shadow-sm.mb-4
            .card-header.bg-white.py-3
              .d-flex.justify-content-between.align-items-center
                h2.mb-0.text-primary
                  i.fas.fa-car.me-2
                  | Ride Details
                span.badge.bg-primary.fs-6
                  i.fas.fa-clock.me-1
                  | #{new Date(ride.departure_time).toLocaleString()}
            .card-body
              .row.g-4
                // Location Information
                .col-md-6
                  .location-info.mb-4
                    h4.mb-3
                      i.fas.fa-map-marker-alt.text-danger.me-2
                      | Pickup Location
                    p.fs-5.mb-4 #{ride.pickup_location}
                    
                    h4.mb-3
                      i.fas.fa-flag-checkered.text-success.me-2
                      | Destination
                    p.fs-5 #{ride.dropoff_location}
                
                // Ride Information
                .col-md-6
                  .ride-info.mb-4
                    h4.mb-3
                      i.fas.fa-info-circle.text-primary.me-2
                      | Ride Information
                    .d-flex.align-items-center.mb-2
                      i.fas.fa-clock.text-primary.me-2
                      p.mb-0 Departure: #{new Date(ride.departure_time).toLocaleTimeString()}
                    .d-flex.align-items-center.mb-2
                      i.fas.fa-chair.text-success.me-2
                      p.mb-0 Available Seats: #{ride.seats_available}
                    if ride.tags
                      .d-flex.flex-wrap.gap-1.mt-3
                        each tag in ride.tags.split(',')
                          if tag.trim()
                            a.badge.bg-light.text-dark.text-decoration-none(href=`/rides?tag=${encodeURIComponent(tag.trim())}`)= tag.trim()
              
              hr.my-4
              
              // Driver Information
              .driver-info
                h4.mb-3
                  i.fas.fa-user.text-primary.me-2
                  | About the Driver
                .d-flex.align-items-center
                  img.rounded-circle.me-3(src=getProfilePhoto(ride.profile_photo) alt=`${ride.driver_name}'s profile photo` width='60' height='60')
                  .driver-details
                    h5.mb-1 #{ride.driver_name}
                    a.btn.btn-outline-primary.btn-sm(href=`/users/${ride.driver_id}`)
                      i.fas.fa-user-circle.me-1
                      | View Profile
        
        // Request to Join Card
        .col-lg-4
          .card.shadow-sm.mb-4
            .card-header.bg-white.py-3
              h3.mb-0
                i.fas.fa-handshake.me-2.text-primary
                | Request to Join
            .card-body
              if ride.seats_available > 0
                if userId
                  form(action=`/rides/${ride.id}/request` method='POST')
                    .mb-3
                      label.form-label(for='message')
                        i.fas.fa-comment-alt.me-2
                        | Message to Driver
                      textarea.form-control(
                        id='message'
                        name='message'
                        rows='4'
                        placeholder='Introduce yourself and explain why you want to join this ride'
                      )
                    button.btn.btn-primary.w-100(type='submit')
                      i.fas.fa-paper-plane.me-2
                      | Send Request
                else
                  .card.border-info
                    .card-body.text-center
                      p.card-text
                        i.fas.fa-info-circle.me-2
                        | You need to be logged in to request a ride.
                      button.btn.btn-primary.auth-required(data-action='request' data-ride-id=ride.id)
                        i.fas.fa-sign-in-alt.me-2
                        | Login to Request
              else
                .alert.alert-warning.d-flex.align-items-center
                  i.fas.fa-exclamation-triangle.me-2
                  | No seats available for this ride.
      
      // Ride Requests Section
      if requests && requests.length > 0
        .card.shadow-sm
          .card-header.bg-white.py-3
            h3.mb-0
              i.fas.fa-users.me-2.text-primary
              | Ride Requests
          .card-body.p-0
            .list-group.list-group-flush
              each request in requests
                .list-group-item
                  .d-flex.justify-content-between.align-items-start
                    .d-flex.align-items-start
                      img.rounded-circle.me-3(src=getProfilePhoto(request.profile_photo) alt=`${request.passenger_name}'s profile photo` width='50' height='50')
                      .d-flex.flex-column
                        h6.mb-1 #{request.passenger_name}
                        small.text-muted.mb-2
                          i.far.fa-clock.me-1
                          | #{new Date(request.requested_at).toLocaleString()}
                        if request.message
                          .message-box.bg-light.p-2.rounded.mb-2
                            small.text-muted
                              i.fas.fa-comment-alt.me-1
                              | Message:
                            p.mb-0.small #{request.message}
                    if request.status === 'pending'
                      if ride.driver_id == userId
                        .btn-group
                          form.me-2(action=`/rides/${ride.id}/requests/${request.id}/accept` method='POST')
                            button.btn.btn-success.btn-sm(type='submit')
                              i.fas.fa-check.me-1
                              | Accept
                          form(action=`/rides/${ride.id}/requests/${request.id}/reject` method='POST')
                            button.btn.btn-danger.btn-sm(type='submit')
                              i.fas.fa-times.me-1
                              | Reject
                      else
                        span.badge.bg-warning
                          i.fas.fa-clock.me-1
                          | Pending
                    else
                      span.badge(class=request.status === 'accepted' ? 'bg-success' : 'bg-danger')
                        i.fas(class=request.status === 'accepted' ? 'fa-check' : 'fa-times').me-1
                        | #{request.status.charAt(0).toUpperCase() + request.status.slice(1)}
  else
    .container.py-4
      .alert.alert-warning.d-flex.align-items-center
        i.fas.fa-exclamation-circle.me-2
        h4.mb-0 Ride Not Found
        p.mb-0.ms-2 The ride you're looking for doesn't exist or has been removed. 