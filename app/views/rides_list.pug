extends layout

block content
  .container
    h1.title Available Rides
    
    .rides-filters
      form.filter-form(action="/rides" method="GET")
        .form-group
          label(for="from") From:
          input.form-control(type="text" id="from" name="from" value=query.from)
        
        .form-group
          label(for="to") To:
          input.form-control(type="text" id="to" name="to" value=query.to)
        
        .form-group
          label(for="date") Date:
          input.form-control(type="date" id="date" name="date" value=query.date)
        
        .form-group
          label(for="seats") Minimum Seats:
          input.form-control(type="number" id="seats" name="seats" min="1" value=query.seats)
        
        button.btn.btn-primary(type="submit") Search
    
    if rides.length > 0
      .rides-grid
        each ride in rides
          .ride-card
            .ride-header
              h3.ride-title= ride.title
              .ride-meta
                span.ride-date= new Date(ride.departure_time).toLocaleDateString()
                span.ride-time= new Date(ride.departure_time).toLocaleTimeString()
            
            .ride-details
              .ride-route
                span.route-from= ride.from_location
                span.route-arrow â†’
                span.route-to= ride.to_location
              
              .ride-driver
                if ride.driver_name
                  span.driver-label Driver:
                  span.driver-name= ride.driver_name
              
              .ride-seats
                span.seats-label Available Seats:
                span.seats-count= ride.available_seats
              
              if ride.tags
                .ride-tags
                  each tag in ride.tags.split(',')
                    if tag.trim()
                      span.tag= tag.trim()
            
            .ride-actions
              a.btn.btn-primary(href=`/rides/${ride.id}`) View Details
    else
      p.no-rides No rides found matching your criteria.

block scripts
  script.
    document.getElementById('tagFilter').addEventListener('change', function() {
      const tag = this.value;
      const search = new URLSearchParams(window.location.search).get('search') || '';
      
      if (tag) {
        window.location.href = `/rides?tag=${encodeURIComponent(tag)}${search ? '&search=' + encodeURIComponent(search) : ''}`;
      } else {
        window.location.href = `/rides${search ? '?search=' + encodeURIComponent(search) : ''}`;
      }
    }); 