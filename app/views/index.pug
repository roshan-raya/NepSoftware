extends layout

block content
  // Hero Section
  .container-fluid.bg-primary.text-white.py-5
    .container.py-4
      .row.align-items-center
        .col-lg-6
          h1.display-4.fw-bold Roehampton Ride Sharing
          p.lead.mb-4 Find affordable, convenient, and eco-friendly rides to and from University of Roehampton.
          .d-grid.gap-2.d-md-flex.justify-content-md-start
            a.btn.btn-light.btn-lg.px-4.me-md-2(href="/rides") Find a Ride
            if user && user.is_driver
              a.btn.btn-outline-light.btn-lg.px-4(href="/rides/create") Offer a Ride
            else if user
              a.btn.btn-outline-light.btn-lg.px-4(href="/rides/become_driver") Become a Driver
            else
              a.btn.btn-outline-light.btn-lg.px-4(href="/auth/signup") Sign Up
        .col-lg-6.d-none.d-lg-block
          img.img-fluid.rounded.shadow(src="/images/campus-map.jpg" alt="Roehampton Campus Map")
  
  // Search Section
  .container.mt-5
    .row.justify-content-center
      .col-md-8
        .card.shadow.mb-5
          .card-body.p-4
            h3.card-title.text-center.mb-4 Where are you going?
            form(action="/rides" method="GET")
              .row.g-3
                .col-md-5
                  label.form-label(for="pickup") Pickup
                  input.form-control.form-control-lg#pickup_location(type="text" name="pickup" placeholder="Enter pickup location")
                .col-md-5
                  label.form-label(for="date") Date
                  input.form-control.form-control-lg#date(type="date" name="date")
                .col-md-2.d-flex.align-items-end
                  button.btn.btn-primary.btn-lg.w-100(type="submit")
                    i.fas.fa-search.me-2
                    | Search
  
  // Upcoming Rides
  .container.my-5
    .d-flex.justify-content-between.align-items-center.mb-4
      h2 Upcoming Rides
      a.btn.btn-outline-primary(href="/rides") View All
    
    if upcomingRides && upcomingRides.length > 0
      .row
        each ride in upcomingRides
          .col-md-6.col-lg-4.mb-4
            .card.shadow.ride-card
              .card-header.bg-light
                .d-flex.justify-content-between.align-items-center
                  span
                    i.fas.fa-calendar.me-2
                    = formatDate(ride.departure_time)
                  span.badge.bg-primary
                    i.fas.fa-chair.me-1
                    | #{ride.seats_available - (ride.confirmed_passengers || 0)} seats left
              .card-body
                h5.card-title
                  i.fas.fa-map-marker-alt.text-danger.me-2
                  | #{ride.pickup_location}
                p.card-text.mb-0
                  i.fas.fa-arrow-right.text-success.me-2
                  | #{ride.destination || 'University of Roehampton'}
                
                .d-flex.justify-content-between.align-items-center.mt-3
                  .driver-info.d-flex.align-items-center
                    img.rounded-circle.me-2(src=getProfilePhoto(ride.driver_photo) alt=ride.driver_name width='40' height='40')
                    span.fw-bold #{ride.driver_name}
                  if ride.driver_rating
                    .rating
                      != ratingStars(ride.driver_rating)
                
                if ride.smoking_allowed
                  span.badge.bg-secondary.mt-2
                    i.fas.fa-smoking.me-1
                    | Smoking allowed
                
                if ride.price_per_seat
                  p.fs-5.fw-bold.text-primary.mt-2 Â£#{ride.price_per_seat.toFixed(2)} per seat
              
              .card-footer.bg-white.border-top-0
                a.btn.btn-primary.w-100(href=`/rides/${ride.id}`) View Details
    else
      .alert.alert-info
        i.fas.fa-info-circle.me-2
        | No upcoming rides available at the moment. Please check back later or 
        a(href="/rides/create") offer a ride
        |  yourself!
  
  // How It Works
  .container-fluid.bg-light.py-5
    .container
      h2.text-center.mb-5 How It Works
      .row.text-center
        .col-md-3.mb-4
          .bg-white.rounded-circle.p-4.mx-auto.mb-3(style="width: 120px; height: 120px")
            i.fas.fa-search.fa-3x.text-primary
          h4 Find a Ride
          p Search for rides to or from the university matching your schedule and preferences.
        
        .col-md-3.mb-4
          .bg-white.rounded-circle.p-4.mx-auto.mb-3(style="width: 120px; height: 120px")
            i.fas.fa-check-circle.fa-3x.text-primary
          h4 Book a Seat
          p Request to join a ride and get confirmation from the driver.
        
        .col-md-3.mb-4
          .bg-white.rounded-circle.p-4.mx-auto.mb-3(style="width: 120px; height: 120px")
            i.fas.fa-car.fa-3x.text-primary
          h4 Share the Ride
          p Meet at the pickup location and enjoy your shared journey.
        
        .col-md-3.mb-4
          .bg-white.rounded-circle.p-4.mx-auto.mb-3(style="width: 120px; height: 120px")
            i.fas.fa-star.fa-3x.text-primary
          h4 Rate & Review
          p After your ride, rate your experience to help others.
  
  // Popular Routes
  .container.my-5
    h2.text-center.mb-4 Popular Routes
    #map.mb-4(style="height: 400px;")
    .row.text-center
      .col-md-4.mb-4
        .card.shadow
          .card-body
            h5 Campus to Putney Station
            p.text-muted 2.5 miles, ~10 minutes
            a.btn.btn-outline-primary(href="/rides?pickup=Putney Station") Find Rides
      
      .col-md-4.mb-4
        .card.shadow
          .card-body
            h5 Campus to Barnes Station
            p.text-muted 3.2 miles, ~12 minutes
            a.btn.btn-outline-primary(href="/rides?pickup=Barnes Station") Find Rides
      
      .col-md-4.mb-4
        .card.shadow
          .card-body
            h5 Campus to Kingston
            p.text-muted 4.8 miles, ~15 minutes
            a.btn.btn-outline-primary(href="/rides?pickup=Kingston") Find Rides

block scripts
  script(src=`https://maps.googleapis.com/maps/api/js?key=${googleMapsApiKey}&callback=initMap` async defer)
  script.
    // Initialize the Google Map
    function initMap() {
      // Roehampton University coordinates
      const roehamptonCoords = { lat: 51.4567, lng: -0.2456 };
      
      // Popular routes
      const routes = [
        { name: "Putney Station", lat: 51.4614, lng: -0.2160 },
        { name: "Barnes Station", lat: 51.4669, lng: -0.2393 },
        { name: "Kingston", lat: 51.4148, lng: -0.3006 }
      ];
      
      // Initialize the map centered at Roehampton
      const map = new google.maps.Map(document.getElementById('map'), {
        center: roehamptonCoords,
        zoom: 12,
        mapTypeControl: false
      });
      
      // Add a marker for Roehampton University
      const roehamptonMarker = new google.maps.Marker({
        position: roehamptonCoords,
        map: map,
        title: 'University of Roehampton',
        icon: {
          url: '/images/map-marker.png',
          scaledSize: new google.maps.Size(40, 40)
        }
      });
      
      // Add markers for popular routes
      routes.forEach(route => {
        const marker = new google.maps.Marker({
          position: { lat: route.lat, lng: route.lng },
          map: map,
          title: route.name
        });
        
        // Draw route line
        const directionsService = new google.maps.DirectionsService();
        const directionsRenderer = new google.maps.DirectionsRenderer({
          map: map,
          suppressMarkers: true,
          polylineOptions: {
            strokeColor: '#4285F4',
            strokeWeight: 4
          }
        });
        
        directionsService.route({
          origin: roehamptonCoords,
          destination: { lat: route.lat, lng: route.lng },
          travelMode: google.maps.TravelMode.DRIVING
        }, (response, status) => {
          if (status === 'OK') {
            directionsRenderer.setDirections(response);
          }
        });
      });
    }